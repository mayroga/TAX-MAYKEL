<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL CIELO - TaxMind Pro AI</title>
    <style>
        :root { 
            --drake-blue: #002D54; 
            --gold: #C5A059; 
            --irs-green: #27AE60; 
            --danger: #C0392B; 
            --dark-bg: #121212; 
            --panel-bg: #F8F9FA;
        }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; margin: 0; background: var(--dark-bg); color: #333; height: 100vh; display: flex; flex-direction: column; }

        .dashboard-header { background: #000; color: #00FF00; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); font-family: 'Courier New', monospace; }
        .risk-badge { padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .risk-low { background: var(--irs-green); color: white; }
        .risk-high { background: var(--danger); color: white; animation: blink 1s infinite; }

        .main-layout { display: grid; grid-template-columns: 280px 1fr 420px; flex-grow: 1; overflow: hidden; }

        /* Sidebar */
        .sidebar { background: #1E272E; color: white; padding: 20px; border-right: 1px solid #000; }
        .mode-selector { margin-bottom: 30px; }
        .nav-grp { font-size: 0.7rem; color: #808E9B; text-transform: uppercase; margin: 20px 0 10px; border-bottom: 1px solid #3d4b59; }
        .nav-item { padding: 12px; cursor: pointer; border-radius: 6px; margin-bottom: 5px; transition: 0.3s; font-size: 0.9rem; }
        .nav-item:hover, .active { background: var(--gold); color: black; font-weight: bold; }

        /* Workspace */
        .workspace { background: white; padding: 40px; overflow-y: auto; border-right: 2px solid #CCC; }
        .tax-card { border: 1px solid #D1D8E0; border-radius: 8px; margin-bottom: 25px; overflow: hidden; }
        .card-header { background: #F1F2F6; padding: 12px 20px; font-weight: bold; color: var(--drake-blue); display: flex; justify-content: space-between; }
        .tax-row { display: grid; grid-template-columns: 80px 1fr 180px; border-bottom: 1px solid #F1F2F6; align-items: center; }
        .ln { background: #F8F9FA; padding: 15px; text-align: center; font-weight: bold; color: #7F8C8D; border-right: 1px solid #EEE; }
        .desc { padding-left: 20px; font-size: 0.95rem; }
        input { width: 100%; border: none; padding: 15px; text-align: right; font-size: 1.2rem; background: #FFFDE7; outline: none; font-weight: 600; }
        input:focus { background: white; box-shadow: inset 0 0 8px rgba(0,0,0,0.1); }

        /* AURA */
        .aura-panel { background: var(--panel-bg); display: flex; flex-direction: column; border-left: 1px solid var(--gold); }
        .aura-header { background: var(--drake-blue); color: white; padding: 20px; text-align: center; font-weight: 700; }
        .aura-chat { flex-grow: 1; padding: 20px; overflow-y: auto; font-size: 0.95rem; }
        .msg { background: white; padding: 15px; border-radius: 8px; border-left: 5px solid var(--irs-green); margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .msg-strategy { border-left-color: var(--gold); background: #FFF9EB; }
        .msg-alert { border-left-color: var(--danger); background: #FFF5F5; font-weight: bold; }

        .aura-input-area { padding: 20px; background: white; border-top: 1px solid #DDD; }
        #ai-query { width: 100%; padding: 15px; border: 2px solid #D1D8E0; border-radius: 8px; font-size: 1rem; }

        /* Footer */
        .footer { padding: 20px; background: #D1D8E0; display: flex; gap: 15px; justify-content: flex-end; }
        button { padding: 12px 25px; cursor: pointer; font-weight: bold; border: none; border-radius: 6px; text-transform: uppercase; transition: 0.2s; }
        .btn-doubts { background: var(--gold); color: black; }
        .btn-print { background: var(--drake-blue); color: white; }
        .btn-delete { background: var(--danger); color: white; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="dashboard-header">
    <div style="display: flex; gap: 40px; align-items: center;">
        <span>AL CIELO v2.6 | <b id="client-view">TAX OFFICE MODE</b></span>
        <span>AGI: <b id="top-agi">$0.00</b></span>
        <span>REFUND: <b id="top-refund" style="color: #00FF00;">$0.00</b></span>
    </div>
    <div id="risk-box" class="risk-badge risk-low">AUDIT RISK: LOW</div>
</div>

<div class="main-layout">
    <aside class="sidebar">
        <div class="mode-selector">
            <button style="width: 100%; background: var(--gold); margin-bottom: 10px;" onclick="switchMode('Client')">VIEW AS CLIENT</button>
            <button style="width: 100%; background: var(--drake-blue); color: white;" onclick="switchMode('CPA')">VIEW AS PRO (CPA)</button>
        </div>
        <div class="nav-grp">Tax Intelligence</div>
        <div class="nav-item active" onclick="tab('1040')">Form 1040 (Optimization)</div>
        <div class="nav-item" onclick="tab('schc')">Business Strategy (Sch C)</div>
        <div class="nav-grp">Legal & Audit</div>
        <div class="nav-item" onclick="tab('risk')">Risk Analysis Report</div>
        <div class="nav-item" onclick="tab('docs')">Audit Trail & Logs</div>
    </aside>

    <main class="workspace">
        <div id="t-1040">
            <div class="form-header">
                Interactive Form 1040 - Tax Year 2026
                <span style="font-size: 0.8rem; font-weight: normal;">(Real-time Triangulation Active)</span>
            </div>
            
            <div class="tax-card">
                <div class="card-header"><span>Identity & Context</span> <span>IRC Sec. 61</span></div>
                <div class="tax-row"><div class="ln">NAME</div><div class="desc">Taxpayer Name</div><input type="text" id="tax_name" oninput="taxEngine()"></div>
                <div class="tax-row"><div class="ln">AGE</div><div class="desc">Age (Determines Catch-up limits)</div><input type="number" id="age" value="50" oninput="taxEngine()"></div>
            </div>

            <div class="tax-card">
                <div class="card-header"><span>Income & Assets</span> <span>Line 1-11</span></div>
                <div class="tax-row"><div class="ln">1</div><div class="desc">W-2 Wages</div><input type="number" id="in-w2" value="0" oninput="taxEngine()"></div>
                <div class="tax-row"><div class="ln">2</div><div class="desc">Federal Tax Withheld</div><input type="number" id="in-withheld" value="0" oninput="taxEngine()"></div>
                <div class="tax-row"><div class="ln">8</div><div class="desc">Self-Employed Net (Sch C Transfer)</div><input type="number" id="in-schc-link" readonly></div>
                <div class="tax-row total-row"><div class="ln">11</div><div class="desc">Adjusted Gross Income (AGI)</div><input type="number" id="in-agi" readonly></div>
            </div>
        </div>

        <div id="t-schc" class="hidden">
            <div class="form-header">Schedule C Intelligence (Strategy Mode)</div>
            <div class="tax-card">
                <div class="tax-row"><div class="ln">1</div><div class="desc">Gross Receipts</div><input type="number" id="in-gross" value="0" oninput="taxEngine()"></div>
                <div class="tax-row"><div class="ln">28</div><div class="desc">Business Expenses</div><input type="number" id="in-exp" value="0" oninput="taxEngine()"></div>
                <div class="tax-row total-row"><div class="ln">31</div><div class="desc">Net Business Profit</div><input type="number" id="in-net" readonly></div>
            </div>
        </div>
    </main>

    <aside class="aura-panel">
        <div class="aura-header">ðŸ§  AURA SENIOR ADVISOR</div>
        <div class="aura-chat" id="aura-chat">
            <div class="msg">AURA: Bienvenido al modo Tax Intelligence. Estoy monitoreando su AGI y flujo de caja del IRS en tiempo real.</div>
        </div>
        <div class="aura-input-area">
            <input type="text" id="ai-query" placeholder="Duda fiscal? (Ej: Â¿Es deducible mi oficina?)" onkeypress="handleAura(event)">
        </div>
    </aside>
</div>

<div class="footer">
    <button class="btn-delete" onclick="resetSystem()">Clear All Data</button>
    <button class="btn-doubts" onclick="clearDoubts()">Explain Every Line</button>
    <button class="btn-print" onclick="window.print()">Print PDF & Audit Trail</button>
</div>

<script>
/* ---------------- TAX DATA 2026 ---------------- */
const TAX_BRACKETS_2026 = {
    single: [
        { limit: 11600, rate: 0.10 },
        { limit: 47150, rate: 0.12 },
        { limit: 100525, rate: 0.22 },
        { limit: 191950, rate: 0.24 },
        { limit: 243725, rate: 0.32 },
        { limit: 609350, rate: 0.35 },
        { limit: Infinity, rate: 0.37 }
    ],
    mfj: [
        { limit: 23200, rate: 0.10 },
        { limit: 94300, rate: 0.12 },
        { limit: 201050, rate: 0.22 },
        { limit: 383900, rate: 0.24 },
        { limit: 487450, rate: 0.32 },
        { limit: 731200, rate: 0.35 },
        { limit: Infinity, rate: 0.37 }
    ],
    mfs: [
        { limit: 11600, rate: 0.10 },
        { limit: 47150, rate: 0.12 },
        { limit: 100525, rate: 0.22 },
        { limit: 191950, rate: 0.24 },
        { limit: 243725, rate: 0.32 },
        { limit: 365600, rate: 0.35 },
        { limit: Infinity, rate: 0.37 }
    ],
    hoh: [
        { limit: 16550, rate: 0.10 },
        { limit: 63550, rate: 0.12 },
        { limit: 100500, rate: 0.22 },
        { limit: 191950, rate: 0.24 },
        { limit: 243700, rate: 0.32 },
        { limit: 609350, rate: 0.35 },
        { limit: Infinity, rate: 0.37 }
    ]
};

const STANDARD_DEDUCTIONS_2026 = {
    single: 15700,
    mfj: 31400,
    mfs: 15700,
    hoh: 23550
};

/* ---------------- TAX ENGINE ---------------- */
function calculateIncomeTax(taxableIncome, filingStatus) {
    let tax = 0;
    let remainingIncome = taxableIncome;
    const brackets = TAX_BRACKETS_2026[filingStatus] || TAX_BRACKETS_2026.single;

    for (let i = 0; i < brackets.length; i++) {
        const prevLimit = i === 0 ? 0 : brackets[i-1].limit;
        const bracketAmount = Math.min(remainingIncome, brackets[i].limit - prevLimit);
        if (bracketAmount > 0) {
            tax += bracketAmount * brackets[i].rate;
            remainingIncome -= bracketAmount;
        } else break;
    }
    return tax;
}

function taxEngine() {
    const taxName = document.getElementById('tax_name').value;
    const filingStatus = 'single'; // TODO: agregar selector real
    const wages = parseFloat(document.getElementById('in-w2').value) || 0;
    const gross = parseFloat(document.getElementById('in-gross').value) || 0;
    const expenses = parseFloat(document.getElementById('in-exp').value) || 0;

    const netProfit = Math.max(0, gross - expenses);
    document.getElementById('in-net').value = netProfit.toFixed(2);
    document.getElementById('in-schc-link').value = netProfit.toFixed(2);

    const seTaxable = netProfit * 0.9235;
    const seTax = seTaxable * 0.153;
    const seDeduction = seTax / 2;

    const agi = (wages + netProfit) - seDeduction;
    document.getElementById('in-agi').value = agi.toFixed(2);
    document.getElementById('top-agi').innerText = `$${agi.toLocaleString()}`;

    const taxableIncome = Math.max(0, agi - STANDARD_DEDUCTIONS_2026[filingStatus]);
    const incomeTax = calculateIncomeTax(taxableIncome, filingStatus);
    const totalOwe = incomeTax + seTax;

    const withheld = parseFloat(document.getElementById('in-withheld').value) || 0;
    const refund = withheld - totalOwe;

    document.getElementById('top-refund').innerText = `$${refund >=0 ? refund.toLocaleString() : '0.00'}`;
    document.getElementById('top-refund').style.color = refund >= 0 ? "#00FF00" : "#FF3131";

    updateAuraAdvise(netProfit, expenses, gross, agi, filingStatus);
    updateRisk(gross, expenses, netProfit, agi);
}

function updateRisk(g, e, n, a) {
    const rb = document.getElementById('risk-box');
    if(e > g*0.65 && g>0) {
        rb.innerText = "AUDIT RISK: HIGH";
        rb.className = "risk-badge risk-high";
    } else {
        rb.innerText = "AUDIT RISK: LOW";
        rb.className = "risk-badge risk-low";
    }
}

function pushAura(msg, cls="msg") {
    const chat = document.getElementById('aura-chat');
    const div = document.createElement('div');
    div.className = cls;
    div.innerHTML = msg;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function updateAuraAdvise(net, exp, gross, agi, filingStatus) {
    const chat = document.getElementById('aura-chat');
    chat.innerHTML = "";
    if(exp > gross*0.6 && gross>0) pushAura("âš ï¸ ALERTA: Gastos excesivos detectados. Conserve recibos.", "msg-alert");
    if(net > 60000 && filingStatus !== 'mfs') pushAura(`ðŸ’¡ ESTRATEGIA: Con un Net Profit de $${net.toLocaleString()}, considere S-Corp para ahorrar Self-Employment Tax.`, "msg-strategy");
    if(agi > 150000 && filingStatus !== 'mfs') pushAura("ðŸš¨ AVISO AVANZADO: AGI elevado. Revise AMT.", "msg-alert");
}

function handleAura(e) {
    if(e.key === 'Enter') {
        const
