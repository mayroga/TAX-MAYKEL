<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL CIELO - TaxMind Pro AI</title>
    <style>
        :root { 
            --drake-blue: #002D54; --gold: #C5A059; --irs-green: #27AE60; 
            --danger: #C0392B; --dark-bg: #121212; --panel-bg: #F8F9FA;
        }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; margin: 0; background: var(--dark-bg); color: #333; height: 100vh; display: flex; flex-direction: column; }
        <link rel="stylesheet" href="styles.css">

<script src="tax_data.js"></script>
<script src="engine.js"></script>

        /* Dashboard de Inteligencia */
        .dashboard-header { background: #000; color: #00FF00; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); font-family: 'Courier New', monospace; }
        .risk-badge { padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .risk-low { background: var(--irs-green); color: white; }
        .risk-high { background: var(--danger); color: white; animation: blink 1s infinite; }

        .main-layout { display: grid; grid-template-columns: 280px 1fr 420px; flex-grow: 1; overflow: hidden; }

        /* Sidebar: Modos de Vista */
        .sidebar { background: #1E272E; color: white; padding: 20px; border-right: 1px solid #000; }
        .mode-selector { margin-bottom: 30px; }
        .nav-grp { font-size: 0.7rem; color: #808E9B; text-transform: uppercase; margin: 20px 0 10px; border-bottom: 1px solid #3d4b59; }
        .nav-item { padding: 12px; cursor: pointer; border-radius: 6px; margin-bottom: 5px; transition: 0.3s; font-size: 0.9rem; }
        .nav-item:hover, .active { background: var(--gold); color: black; font-weight: bold; }

        /* Workspace: El Motor que Piensa */
        .workspace { background: white; padding: 40px; overflow-y: auto; border-right: 2px solid #CCC; }
        .tax-card { border: 1px solid #D1D8E0; border-radius: 8px; margin-bottom: 25px; overflow: hidden; }
        .card-header { background: #F1F2F6; padding: 12px 20px; font-weight: bold; color: var(--drake-blue); display: flex; justify-content: space-between; }
        
        .tax-row { display: grid; grid-template-columns: 80px 1fr 180px; border-bottom: 1px solid #F1F2F6; align-items: center; }
        .ln { background: #F8F9FA; padding: 15px; text-align: center; font-weight: bold; color: #7F8C8D; border-right: 1px solid #EEE; }
        .desc { padding-left: 20px; font-size: 0.95rem; }
        input { width: 100%; border: none; padding: 15px; text-align: right; font-size: 1.2rem; background: #FFFDE7; outline: none; font-weight: 600; }
        input:focus { background: white; box-shadow: inset 0 0 8px rgba(0,0,0,0.1); }

        /* AURA: El Cerebro Senior */
        .aura-panel { background: var(--panel-bg); display: flex; flex-direction: column; border-left: 1px solid var(--gold); }
        .aura-header { background: var(--drake-blue); color: white; padding: 20px; text-align: center; font-weight: 700; }
        .aura-chat { flex-grow: 1; padding: 20px; overflow-y: auto; font-size: 0.95rem; }
        .msg { background: white; padding: 15px; border-radius: 8px; border-left: 5px solid var(--irs-green); margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .msg-strategy { border-left-color: var(--gold); background: #FFF9EB; }
        .msg-alert { border-left-color: var(--danger); background: #FFF5F5; font-weight: bold; }

        .aura-input-area { padding: 20px; background: white; border-top: 1px solid #DDD; }
        #ai-query { width: 100%; padding: 15px; border: 2px solid #D1D8E0; border-radius: 8px; font-size: 1rem; }

        /* Footer */
        .footer { padding: 20px; background: #D1D8E0; display: flex; gap: 15px; justify-content: flex-end; }
        button { padding: 12px 25px; cursor: pointer; font-weight: bold; border: none; border-radius: 6px; text-transform: uppercase; transition: 0.2s; }
        .btn-doubts { background: var(--gold); color: black; }
        .btn-print { background: var(--drake-blue); color: white; }
        .btn-delete { background: var(--danger); color: white; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="dashboard-header">
    <div style="display: flex; gap: 40px; align-items: center;">
        <span>AL CIELO v2.6 | <b id="client-view">TAX OFFICE MODE</b></span>
        <span>AGI: <b id="top-agi">$0.00</b></span>
        <span>REFUND: <b id="top-refund" style="color: #00FF00;">$0.00</b></span>
    </div>
    <div id="risk-box" class="risk-badge risk-low">AUDIT RISK: LOW</div>
</div>

<div class="main-layout">
    <aside class="sidebar">
        <div class="mode-selector">
            <button style="width: 100%; background: var(--gold); margin-bottom: 10px;" onclick="switchMode('Client')">VIEW AS CLIENT</button>
            <button style="width: 100%; background: var(--drake-blue); color: white;" onclick="switchMode('CPA')">VIEW AS PRO (CPA)</button>
        </div>
        <div class="nav-grp">Tax Intelligence</div>
        <div class="nav-item active" onclick="tab('1040')">Form 1040 (Optimization)</div>
        <div class="nav-item" onclick="tab('schc')">Business Strategy (Sch C)</div>
        <div class="nav-grp">Legal & Audit</div>
        <div class="nav-item" onclick="tab('risk')">Risk Analysis Report</div>
        <div class="nav-item" onclick="tab('docs')">Audit Trail & Logs</div>
    </aside>

    <main class="workspace">
        <div id="t-1040">
            <div class="form-header">
                Interactive Form 1040 - Tax Year 2026
                <span style="font-size: 0.8rem; font-weight: normal;">(Real-time Triangulation Active)</span>
            </div>
            
            <div class="tax-card">
                <div class="card-header"><span>Identity & Context</span> <span>IRC Sec. 61</span></div>
                <div class="tax-row"><div class="ln">NAME</div><div class="desc">Taxpayer Name</div><input type="text" id="name" oninput="engine()"></div>
                <div class="tax-row"><div class="ln">AGE</div><div class="desc">Age (Determines Catch-up limits)</div><input type="number" id="age" value="50" oninput="engine()"></div>
            </div>

            <div class="tax-card">
                <div class="card-header"><span>Income & Assets</span> <span>Line 1-11</span></div>
                <div class="tax-row"><div class="ln">1z</div><div class="desc">W-2 Wages (Salaries, tips)</div><input type="number" id="w2" value="0" oninput="engine()"></div>
                <div class="tax-row"><div class="ln">2</div><div class="desc">Federal Tax Withheld (Box 2)</div><input type="number" id="withheld" value="0" oninput="engine()"></div>
                <div class="tax-row"><div class="ln">8</div><div class="desc">Self-Employed Net (Sch C Transfer)</div><input type="number" id="sc-link" readonly></div>
                <div class="tax-row total-row"><div class="ln">11</div><div class="desc">ADJUSTED GROSS INCOME (AGI)</div><input type="number" id="agi-val" readonly></div>
            </div>
        </div>

        <div id="t-schc" class="hidden">
            <div class="form-header">Schedule C Intelligence (Strategy Mode)</div>
            <div class="tax-card">
                <div class="tax-row"><div class="ln">1</div><div class="desc">Gross Receipts</div><input type="number" id="gross" value="0" oninput="engine()"></div>
                <div class="tax-row"><div class="ln">28</div><div class="desc">Business Expenses</div><input type="number" id="exp" value="0" oninput="engine()"></div>
                <div class="tax-row total-row"><div class="ln">31</div><div class="desc">Net Business Profit</div><input type="number" id="net" readonly></div>
            </div>
        </div>
    </main>

    <aside class="aura-panel">
        <div class="aura-header">üß† AURA SENIOR ADVISOR</div>
        <div class="aura-chat" id="chat">
            <div class="msg">AURA: Bienvenido al modo Tax Intelligence. Estoy monitoreando su AGI y el flujo de caja del IRS en tiempo real.</div>
        </div>
        <div class="aura-input-area">
            <input type="text" id="ai-query" placeholder="Duda fiscal? (Ej: ¬øEs deducible mi oficina?)" onkeypress="handleAI(event)">
        </div>
    </aside>
</div>

<div class="footer">
    <button class="btn-delete" onclick="location.reload()">Clear All Data</button>
    <button class="btn-doubts" onclick="clearDoubts()">Explain Every Line</button>
    <button class="btn-print" onclick="window.print()">Print PDF & Audit Trail</button>
</div>

<script>
    // MOTOR DE INTELIGENCIA FISCAL (IRC 2026)
    function engine() {
        const age = parseInt(document.getElementById('age').value) || 0;
        const w2 = parseFloat(document.getElementById('w2').value) || 0;
        const withheld = parseFloat(document.getElementById('withheld').value) || 0;
        const gross = parseFloat(document.getElementById('gross').value) || 0;
        const exp = parseFloat(document.getElementById('exp').value) || 0;

        // 1. Triangulaci√≥n Profesional
        const net = Math.max(0, gross - exp);
        document.getElementById('net').value = net.toFixed(2);
        document.getElementById('sc-link').value = net.toFixed(2);

        // 2. C√°lculo de SE Tax (Autoempleo)
        const seTax = net * 0.9235 * 0.153;

        // 3. AGI Real
        const agi = (w2 + net) - (seTax / 2);
        document.getElementById('agi-val').value = agi.toFixed(2);
        document.getElementById('top-agi').innerText = `$${agi.toLocaleString()}`;

        // 4. Tax Liability vs Refund
        const stdDed = 15700; // Single 2026
        const taxable = Math.max(0, agi - stdDed);
        const incomeTax = taxable * (taxable > 50000 ? 0.22 : 0.12);
        const totalTax = incomeTax + seTax;

        const result = withheld - totalTax;

        // 5. UI Updates
        document.getElementById('top-refund').innerText = `$${result >= 0 ? result.toLocaleString() : '0.00'}`;
        document.getElementById('top-refund').style.color = result >= 0 ? "#00FF00" : "#FF3131";

        // 6. MOTOR DE RIESGO (AUDIT DETECTOR)
        updateRisk(gross, exp, net, agi);
        auraAdvisor(age, w2, net, exp);
    }

    function updateRisk(g, e, n, a) {
        const rb = document.getElementById('risk-box');
        if(e > (g * 0.65) && g > 0) {
            rb.innerText = "AUDIT RISK: HIGH";
            rb.className = "risk-badge risk-high";
        } else {
            rb.innerText = "AUDIT RISK: LOW";
            rb.className = "risk-badge risk-low";
        }
    }

    function auraAdvisor(age, w2, net, exp) {
        const chat = document.getElementById('chat');
        chat.innerHTML = ""; // Refresh proactivo
        
        if(age >= 50) pushAura("üí° <b>Estrategia 50+:</b> Califica para 'Catch-up' de $1,000 en su IRA. Reducci√≥n potencial de impuestos futura.", "msg msg-strategy");
        if(w2 === 15600) pushAura("‚úÖ <b>Validaci√≥n:</b> Sus ingresos W-2 est√°n por debajo de la Deducci√≥n Est√°ndar. Tax liability Federal = $0.", "msg");
        if(exp > 0 && (exp/net > 0.5)) pushAura("‚ö†Ô∏è <b>Advertencia:</b> Sus gastos comerciales son agresivos respecto a la utilidad. Asegure sus recibos.", "msg msg-alert");
    }

    // EXPLICACI√ìN L√çNEA POR L√çNEA (MODO CLIENTE)
    function clearDoubts() {
        const agi = document.getElementById('agi-val').value;
        const text = `
            <b>Explicaci√≥n Paso a Paso:</b><br>
            1. El IRS le permite ganar hasta $15,700 sin pagar impuestos federales.<br>
            2. Su AGI es de $${agi}.<br>
            3. Como su ingreso es menor al l√≠mite, todo el dinero que le quitaron en su cheque (W-2 Box 2) le pertenece de vuelta.<br>
            4. <b>Conclusi√≥n:</b> Usted no est√° pagando impuestos, est√° recuperando su propio dinero.
        `;
        pushAura(text, "msg msg-strategy");
    }

    function switchMode(mode) {
        document.getElementById('client-view').innerText = mode.toUpperCase() + " MODE";
        pushAura(`Cambiando a modo <b>${mode}</b>. La interfaz ahora muestra detalles ${mode === 'CPA' ? 't√©cnicos y c√≥digos IRC' : 'simples y explicativos'}.`, "msg");
    }

    function pushAura(m, cls) {
        const chat = document.getElementById('chat');
        const div = document.createElement('div');
        div.className = cls;
        div.innerHTML = m;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    function tab(id) {
        document.querySelectorAll('.workspace > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('t-' + id).classList.remove('hidden');
    }

    engine();
</script>
</body>
</html>
