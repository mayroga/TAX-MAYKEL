<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL CIELO - Senior Tax Specialist & AI Engine</title>
    <style>
        :root { --drake-blue: #002D54; --gold: #C5A059; --irs-green: #27AE60; --danger: #C0392B; --light: #F4F7F6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: #1A1A1A; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Barra de Estado Drake */
        .status-bar { background: #000; color: #00FF00; padding: 12px 25px; display: flex; justify-content: space-between; font-family: 'Courier New', monospace; border-bottom: 2px solid var(--gold); z-index: 100; }
        .status-bar b { color: white; margin-right: 5px; }

        .main-layout { display: grid; grid-template-columns: 260px 1fr 400px; flex-grow: 1; overflow: hidden; }

        /* Navegaci√≥n de Formularios */
        .sidebar { background: #2C3E50; color: white; padding: 15px; border-right: 1px solid #000; }
        .nav-header { font-size: 0.75rem; color: #95A5A6; text-transform: uppercase; margin: 15px 0 5px 5px; }
        .nav-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #34495E; font-size: 0.9rem; transition: 0.3s; }
        .nav-item:hover, .active { background: var(--gold); color: black; font-weight: bold; }

        /* Workspace: El Motor Contable */
        .workspace { background: white; padding: 30px; overflow-y: auto; border-right: 2px solid #CCC; }
        .form-title { background: #ECF0F1; padding: 12px; border: 1px solid #BDC3C7; font-weight: bold; color: var(--drake-blue); margin-bottom: 20px; text-transform: uppercase; }
        .tax-row { display: grid; grid-template-columns: 70px 1fr 200px; border-bottom: 1px solid #EEE; align-items: center; }
        .ln { background: #F4F4F4; padding: 12px; text-align: center; font-weight: bold; border-right: 1px solid #DDD; font-size: 0.85rem; }
        .desc { padding-left: 15px; font-size: 0.9rem; }
        input, select { width: 100%; border: none; padding: 12px; text-align: right; font-size: 1.1rem; background: #FFFDE7; outline: none; }
        input:focus { background: white; border-bottom: 2px solid var(--drake-blue); }
        .total-row { background: #E8F8F5 !important; font-weight: bold; }

        /* AURA: Redundant AI Panel */
        .aura-panel { background: var(--light); display: flex; flex-direction: column; border-left: 2px solid var(--gold); }
        .aura-header { background: var(--drake-blue); color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 1.1rem; }
        .aura-chat { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .aura-input { padding: 20px; border-top: 1px solid #CCC; background: white; }
        #query { width: 100%; padding: 15px; border: 2px solid var(--drake-blue); border-radius: 5px; }

        .bot-msg { background: white; padding: 15px; border-left: 5px solid var(--irs-green); border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-size: 0.9rem; }
        .alert-msg { background: #FDEDEC; padding: 15px; border-left: 5px solid var(--danger); color: var(--danger); font-weight: bold; border-radius: 5px; }

        /* Footer */
        .footer { padding: 20px; background: #BDC3C7; display: flex; gap: 15px; justify-content: flex-end; }
        button { padding: 12px 30px; cursor: pointer; font-weight: bold; border: none; border-radius: 4px; text-transform: uppercase; }
        .btn-p { background: var(--drake-blue); color: white; }
        .btn-d { background: var(--danger); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="status-bar">
    <span><b>TAXPAYER:</b> <span id="top-name">NOT SELECTED</span></span>
    <span><b>AGI:</b> <span id="top-agi">$0.00</span></span>
    <span><b>REFUND/OWE:</b> <span id="top-tax">$0.00</span></span>
    <span><b>AI ENGINE:</b> <span id="active-ai" style="color: #00FF00;">GEMINI_PRO</span></span>
</div>

<div class="main-layout">
    <nav class="sidebar">
        <div class="nav-header">Primary Forms</div>
        <div class="nav-item active" onclick="tab('1040')">Form 1040 (Summary)</div>
        <div class="nav-item" onclick="tab('schc')">Schedule C (Business)</div>
        <div class="nav-header">Assets & Adjustments</div>
        <div class="nav-item" onclick="tab('4562')">Form 4562 (Depreciation)</div>
        <div class="nav-item" onclick="tab('8829')">Form 8829 (Home Office)</div>
    </nav>

    <main class="workspace">
        <div id="f-1040">
            <div class="form-title">Form 1040 - U.S. Individual Tax Return 2026</div>
            <div class="tax-row"><div class="ln">ID</div><div class="desc">Full Legal Name</div><input type="text" id="c-name" placeholder="John Doe" oninput="runEngine()"></div>
            <div class="tax-row"><div class="ln">S</div><div class="desc">Filing Status (Single/MFJ/HOH)</div>
                <select id="c-status" onchange="runEngine()">
                    <option value="single">Single</option>
                    <option value="mfj">Married Filing Jointly</option>
                    <option value="hoh">Head of Household</option>
                </select>
            </div>
            <div class="tax-row"><div class="ln">1z</div><div class="desc">Wages, Salaries, W-2 Income</div><input type="number" id="c-w2" value="0" oninput="runEngine()"></div>
            <div class="tax-row"><div class="ln">8</div><div class="desc">Business Income (Transfer from Sch C)</div><input type="number" id="link-schc" readonly></div>
            <div class="tax-row total-row"><div class="ln">11</div><div class="desc">ADJUSTED GROSS INCOME (AGI)</div><input type="number" id="c-agi" readonly></div>
        </div>

        <div id="f-schc" class="hidden">
            <div class="form-title">Schedule C - Profit or Loss from Business</div>
            <div class="tax-row"><div class="ln">1</div><div class="desc">Gross Receipts or Sales</div><input type="number" id="c-gross" value="0" oninput="runEngine()"></div>
            <div class="tax-row"><div class="ln">13</div><div class="desc">Depreciation (Transfer from 4562)</div><input type="number" id="link-dep" readonly></div>
            <div class="tax-row"><div class="ln">28</div><div class="desc">Total Business Expenses</div><input type="number" id="c-exp" value="0" oninput="runEngine()"></div>
            <div class="tax-row total-row"><div class="ln">31</div><div class="desc">NET PROFIT OR LOSS</div><input type="number" id="c-net" readonly></div>
        </div>

        <div id="f-4562" class="hidden">
            <div class="form-title">Form 4562 - Depreciation (Section 179)</div>
            <div class="tax-row"><div class="ln">1</div><div class="desc">Section 179 Expense Deduction</div><input type="number" id="c-s179" value="0" oninput="runEngine()"></div>
            <div class="tax-row"><div class="ln">19</div><div class="desc">MACRS Depreciation</div><input type="number" id="c-macrs" value="0" oninput="runEngine()"></div>
            <div class="tax-row total-row"><div class="ln">22</div><div class="desc">TOTAL DEPRECIATION</div><input type="number" id="c-tdep" readonly></div>
        </div>
    </main>

    <aside class="aura-panel">
        <div class="aura-header">üß† AURA SENIOR ADVISOR</div>
        <div class="aura-chat" id="chat">
            <div class="bot-msg">AURA: Sistema Senior Activo. He sincronizado la l√≥gica de Drake con las leyes de 2026. Estoy lista para auditar sus datos.</div>
        </div>
        <div class="aura-input">
            <input type="text" id="query" placeholder="Consulte leyes o pida an√°lisis t√©cnico..." onkeypress="ask(event)">
        </div>
    </aside>
</div>

<div class="footer">
    <button class="btn-d" onclick="location.reload()">Borrar Sesi√≥n</button>
    <button class="btn-p" onclick="window.print()">Generar PDF Transcription</button>
</div>

<script>
    // MOTOR DE TRIANGULACI√ìN (DRAKE DATA-FLOW)
    function runEngine() {
        // Datos de Entrada
        const name = document.getElementById('c-name').value.toUpperCase();
        const w2 = parseFloat(document.getElementById('c-w2').value) || 0;
        const gross = parseFloat(document.getElementById('c-gross').value) || 0;
        const expenses = parseFloat(document.getElementById('c-exp').value) || 0;
        const s179 = parseFloat(document.getElementById('c-s179').value) || 0;
        const macrs = parseFloat(document.getElementById('c-macrs').value) || 0;
        const status = document.getElementById('c-status').value;

        // 1. FLUJO: Form 4562 -> Schedule C
        const totalDep = s179 + macrs;
        document.getElementById('c-tdep').value = totalDep.toFixed(2);
        document.getElementById('link-dep').value = totalDep.toFixed(2);

        // 2. FLUJO: Schedule C -> Form 1040
        const netProfit = Math.max(0, gross - expenses - totalDep);
        document.getElementById('c-net').value = netProfit.toFixed(2);
        document.getElementById('link-schc').value = netProfit.toFixed(2);

        // 3. C√ÅLCULO DE IMPUESTOS (L√≥gica Senior 2026)
        const seTax = netProfit * 0.9235 * 0.153;
        const agi = (w2 + netProfit) - (seTax / 2);
        
        // 4. TAX BRACKETS (Simplified Progressive)
        const stdDed = { single: 15700, mfj: 31400, hoh: 23550 }[status];
        const taxable = Math.max(0, agi - stdDed);
        let incomeTax = taxable * (taxable > 100000 ? 0.24 : (taxable > 50000 ? 0.22 : 0.12));

        const totalDue = incomeTax + seTax;

        // ACTUALIZACI√ìN DE INTERFAZ
        document.getElementById('c-agi').value = agi.toFixed(2);
        document.getElementById('top-name').innerText = name || "NOT SELECTED";
        document.getElementById('top-agi').innerText = `$${agi.toLocaleString()}`;
        document.getElementById('top-tax').innerText = `$${totalDue.toLocaleString()}`;

        // IA PREVENTIVA (AURA AUDIT)
        if(expenses > (gross * 0.6) && gross > 0) pushAura("‚ö†Ô∏è ALERTA DE RIESGO: Gastos > 60% del ingreso. El IRS disparar√° auditor√≠a por Hobby Loss.", "alert-msg");
        if(netProfit > 60000) pushAura("üí° ESTRATEGIA: Utilidad > $60k. Recomiende S-Corp para blindar el 15.3% de impuestos sobre distribuciones.", "bot-msg");
    }

    // SISTEMA DUAL-AI BRIDGE (FAILOVER)
    async function ask(e) {
        if(e.key === 'Enter') {
            const query = e.target.value;
            pushAura(`<b>Usted:</b> ${query}`, "bot-msg");
            e.target.value = "AURA est√° pensando...";
            
            try {
                // LLAMADA A GEMINI (Primaria)
                const res = await callAI("gemini", query);
                pushAura(`<b>AURA (Senior Specialist):</b> ${res}`, "bot-msg");
            } catch (err) {
                // FALLBACK A OPENAI (Respaldo)
                document.getElementById('active-ai').innerText = "OPENAI_BACKUP";
                document.getElementById('active-ai').style.color = "yellow";
                const res = await callAI("openai", query);
                pushAura(`<b>AURA (Backup Logic):</b> ${res}`, "bot-msg");
            }
            e.target.value = "";
        }
    }

    async function callAI(type, q) {
        // Aqu√≠ conectas con tu API en Render
        // Por ahora, simulamos la respuesta t√©cnica experta
        if(q.toLowerCase().includes("179")) return "La Sec. 179 permite deducir el 100% de equipo calificado (como camiones >6k lbs) hasta $1.16M en 2026.";
        if(q.toLowerCase().includes("irs")) return "Bajo el IRC 2026, la consistencia entre 1099-NEC y Sch C es el foco de auditor√≠a principal.";
        return "Como Contador Senior, le sugiero validar esa entrada contra la Publicaci√≥n 535.";
    }

    function pushAura(m, cls) {
        const chat = document.getElementById('chat');
        if(!chat.innerHTML.includes(m)) {
            const d = document.createElement('div');
            d.className = cls;
            d.innerHTML = m;
            chat.appendChild(d);
            chat.scrollTop = chat.scrollHeight;
        }
    }

    function tab(id) {
        document.querySelectorAll('.workspace > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('f-' + id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.target.classList.add('active');
    }

    runEngine(); // Iniciar sistema
</script>
</body>
</html>
